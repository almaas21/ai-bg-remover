<!DOCTYPE html>
<html>
<head>
    <title>Background Remover - Pay & Use</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
    <h1>Background Remover</h1>

    <button id="payBtn">Pay â‚¹10 to Unlock</button>
    <br><br>
    <input type="file" id="fileInput" disabled>
    <button id="uploadBtn" disabled>Remove Background</button>
    <div id="output"></div>

    <script>
        const BACKEND_URL = "https://your-railway-url"; // change this

        document.getElementById("payBtn").addEventListener("click", async () => {
            const orderRes = await fetch(`${BACKEND_URL}/create-order`, { method: "POST" });
            const orderData = await orderRes.json();

            const options = {
                key: "YOUR_RAZORPAY_KEY_ID", // Public Key
                amount: orderData.amount,
                currency: orderData.currency,
                order_id: orderData.id,
                name: "Background Remover",
                description: "Pay to unlock background removal",
                handler: async function (response) {
                    // Verify payment
                    const verifyRes = await fetch(`${BACKEND_URL}/verify-payment`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(response)
                    });
                    const verifyData = await verifyRes.json();
                    if (verifyData.status === "success") {
                        alert("Payment successful! You can now upload images.");
                        document.getElementById("fileInput").disabled = false;
                        document.getElementById("uploadBtn").disabled = false;
                    } else {
                        alert("Payment verification failed.");
                    }
                }
            };

            const rzp = new Razorpay(options);
            rzp.open();
        });

        document.getElementById("uploadBtn").addEventListener("click", async () => {
            const file = document.getElementById("fileInput").files[0];
            if (!file) {
                alert("Please choose an image first.");
                return;
            }
            const formData = new FormData();
            formData.append("file", file);

            const res = await fetch(`${BACKEND_URL}/remove-bg`, {
                method: "POST",
                body: formData
            });

            if (!res.ok) {
                alert("Payment required or error occurred.");
                return;
            }

            const blob = await res.blob();
            const url = URL.createObjectURL(blob);
            document.getElementById("output").innerHTML = `<img src="${url}" style="max-width:100%">`;
        });
    </script>
</body>
</html>
